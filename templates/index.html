<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InteriorAI 3D</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
    height: 100vh;
}

.app {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.viewer {
    flex: 1;
    position: relative;
    background: #0f172a;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

model-viewer {
    width: 100%;
    height: 100%;
    display: none;
}

#animationContainer {
    width: 100%;
    height: 100%;
    display: none;
    background: #0f172a;
    padding: 20px;
    box-sizing: border-box;
}

#spinner {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.controls {
    background: #1e1e1e;
    padding: 20px;
    display: flex;
    gap: 15px;
    align-items: center;
}

select, textarea, button {
    border-radius: 8px;
    border: none;
}

select {
    padding: 10px;
    background: #2a2a2a;
    color: white;
}

textarea {
    flex: 1;
    padding: 12px;
    resize: none;
    background: #2a2a2a;
    color: white;
}

button {
    padding: 12px 20px;
    background: #3b82f6;
    color: white;
    cursor: pointer;
}

button:hover {
    background: #2563eb;
}
</style>
</head>
<body>

<div class="app">

<div class="viewer">
    <div id="spinner">Loading...</div>
    <model-viewer id="model" camera-controls auto-rotate></model-viewer>

    <div id="animationContainer" style="display:none; width:100%; height:100%; overflow:auto; background:#f8fafc; color:#1e293b; padding:20px;">

  <div style="display:flex; gap:30px; flex-wrap:wrap; align-items:flex-start;">

    <!-- CANVAS -->
    <div style="background:white; border-radius:16px; padding:10px; box-shadow:0 10px 30px rgba(0,0,0,0.08);">
      <canvas id="sim" width="620" height="440"></canvas>
    </div>

    <!-- CONTROL PANEL -->
    <div style="background:white; border-radius:16px; padding:20px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.08);">

      <h3 style="margin-top:0;">Photoelectric Effect</h3>

      <label><strong>Metal Surface</strong></label>
      <div id="materialBtns" style="display:flex; flex-wrap:wrap; gap:8px; margin:10px 0;">
        <button class="material-btn active" data-mat="sodium">Sodium</button>
        <button class="material-btn" data-mat="zinc">Zinc</button>
        <button class="material-btn" data-mat="copper">Copper</button>
        <button class="material-btn" data-mat="platinum">Platinum</button>
      </div>

      <label><strong>Frequency</strong></label>
      <input type="range" id="freqSlider" min="3" max="30" step="0.1" value="10" style="width:100%;">
      <div id="freqVal">10 × 10¹⁴ Hz</div>

      <br>

      <label><strong>Intensity</strong></label>
      <input type="range" id="intensitySlider" min="1" max="20" step="1" value="8" style="width:100%;">
      <div id="intensityVal">8 photons/s</div>

      <br>

      <div id="statusBar" class="status-bar inactive" style="padding:10px; border-radius:8px; background:#e2e8f0;">
        <span id="statusText">Below threshold</span>
      </div>

      <br>

      <div style="font-size:14px;">
        Photon Energy: <span id="photonE">0</span> eV<br>
        Work Function: <span id="workFunc">0</span> eV<br>
        <div id="keCard">
          Electron KE: <span id="electronKE">0</span> eV
        </div>
        Threshold Freq: <span id="threshFreq">0</span>
      </div>

    </div>

  </div>

</div>
</div>

<div class="controls">
    <select id="mode">
        <option value="model">3D Models</option>
        <option value="animation">3D Animations</option>
    </select>

    <textarea id="prompt" placeholder="Type 'photoelectric effect' for animation..."></textarea>

    <button onclick="generate3D()">Generate</button>
</div>

</div>

<script>
async function generate3D() {

    const prompt = document.getElementById("prompt").value.trim();
    const mode = document.getElementById("mode").value;

    const spinner = document.getElementById("spinner");
    const modelViewer = document.getElementById("model");
    const animationContainer = document.getElementById("animationContainer");

    if (!prompt) {
        alert("Enter prompt");
        return;
    }

    if (mode === "animation") {

        if (prompt.toLowerCase().includes("photoelectric")) {

            modelViewer.style.display = "none";
            spinner.style.display = "none";
            animationContainer.style.display = "block";

            startPhotoelectric();
            return;

        } else {
            alert("Only photoelectric effect supported.");
            return;
        }
    }

    animationContainer.style.display = "none";
    spinner.style.display = "block";
    modelViewer.style.display = "none";

    try {
        const response = await fetch("/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt })
        });

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);

        spinner.style.display = "none";
        modelViewer.src = url;
        modelViewer.style.display = "block";

    } catch (err) {
        spinner.style.display = "none";
        alert("Backend error.");
    }
}


</script>
<script src="/static/js/photoelectric.js"></script>
</body>
</html>